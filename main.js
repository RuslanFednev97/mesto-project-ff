(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-12",headers:{authorization:"24b8b0d1-481d-4ff4-84c2-2d32056579ad"}},t=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},n=function(n){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:"PUT",headers:{authorization:e.headers.authorization}}).then(t).catch((function(e){return console.error("Ошибка при загрузке информации о пользователе:",e)}))},r=function(n){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:"DELETE",headers:{authorization:e.headers.authorization}}).then(t).catch((function(e){return console.error("Ошибка при загрузке информации о пользователе:",e)}))};var o=function(e,t){var o=e.closest(".places__item").querySelector(".card__like-count");(e.classList.contains("card__like-button_is-active")?r:n)(t).then((function(t){o.textContent=t.likes.length,e.classList.toggle("card__like-button_is-active")})).catch((function(e){console.log(e)}))};function c(e,t,n,r,o){var c=document.querySelector("#card-template").content.querySelector(".places__item").cloneNode(!0),a=c.querySelector(".card__image"),u=c.querySelector(".card__like-count");a.src=e.link,c.querySelector(".card__title").textContent=e.name,a.alt=e.name,u.textContent=e.likes.length;var i=c.querySelector(".card__delete-button"),l=c.querySelector(".card__like-button");return e.likes.some((function(e){return e._id===o}))&&l.classList.add("card__like-button_is-active"),c.setAttribute("data-card-id",e._id),l.addEventListener("click",(function(){return t(l,e._id)})),a.addEventListener("click",n),e.owner._id===o?i.addEventListener("click",(function(){return r(e._id,c)})):i.classList.add("card__delete-button-unactive"),c}function a(e){document.addEventListener("keydown",i),e.classList.add("popup_is-opened")}function u(e){document.removeEventListener("keydown",i),e.classList.remove("popup_is-opened")}function i(e){"Escape"===e.key&&u(document.querySelector(".popup_is-opened"))}var l=function(e,t,n){t?(e.classList.remove(n),e.disabled=!1):(e.classList.add(n),e.disabled=!0)},s=function(e,t,n,r,o){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r),c.textContent=n,c.classList.add(o)},d=function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n),o.classList.remove(r),o.textContent=""},p=function(e,t,n){var r=!f(e);l(t,r,n)};function f(e){return e.some((function(e){return!e.checkValidity()}))}function _(e,t){var n=t.inputErrorClass,r=t.errorClass,o=t.inactiveButtonClass,c=e.querySelectorAll(".popup__input"),a=e.querySelector(".popup__button");c.forEach((function(t){d(e,t,n,r)})),l(a,!1,o)}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var h,v,y,C,S,b,E,q=document.querySelectorAll(".popup"),g=document.querySelector(".profile__edit-button"),k=document.querySelector(".popup_type_edit"),L=document.querySelector(".popup__close"),x=document.querySelector(".profile__add-button"),A=document.querySelector(".popup_type_new-card"),B=A.querySelector(".popup__close"),z=document.querySelector(".popup_type_image"),T=document.querySelector(".popup__image"),w=z.querySelector(".popup__close"),U=document.forms["new-place"],j=document.forms.avatar,I=document.querySelector(".places__list"),O=document.forms["edit-profile"],D=O.elements.name,P=O.elements.description,N=document.querySelector(".profile__title"),J=document.querySelector(".profile__description"),M=document.querySelector(".popup__caption"),H=document.querySelector(".profile__image"),V=document.querySelector(".popup__delete"),$=V.querySelector(".popup__close"),F=document.querySelector(".popup-avatar"),G=F.querySelector(".popup__close"),K=F.querySelector(".popup__button"),Q=k.querySelector(".popup__button"),R=A.querySelector(".popup__button"),W=document.querySelector(".popup__button-delete"),X=null,Y={currentCardId:null,currentCardElement:null},Z={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function ee(e){var t=e.target.src,n=e.target.alt,r=e.target.closest(".card").querySelector(".card__title").textContent;T.src=t,T.alt=n,M.textContent=r,a(z)}function te(e,t){Y.currentCardId=e,Y.currentCardElement=t,a(V)}g.addEventListener("click",(function(){_(j,{inputErrorClass:Z.inputErrorClass,errorClass:Z.errorClass,inactiveButtonClass:Z.inactiveButtonClass}),D.value=N.textContent,P.value=J.textContent,a(k)})),L.addEventListener("click",(function(){u(k)})),x.addEventListener("click",(function(){_(U,{inputErrorClass:Z.inputErrorClass,errorClass:Z.errorClass,inactiveButtonClass:Z.inactiveButtonClass}),a(A)})),B.addEventListener("click",(function(){u(A)})),w.addEventListener("click",(function(){u(z)})),q.forEach((function(e){e.addEventListener("click",(function(t){t.target===t.currentTarget&&u(e)}))})),O.addEventListener("submit",(function(n){var r,o;n.preventDefault(),Q.textContent="Сохранение...",(r=D.value,o=P.value,fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:{authorization:e.headers.authorization,"Content-Type":"application/json"},body:JSON.stringify({name:r,about:o})}).then(t).catch((function(e){return console.error("Ошибка при загрузке информации о пользователе:",e)}))).then((function(e){N.textContent=e.name,J.textContent=e.about,u(k)})).catch((function(e){console.log(e)})).finally((function(){Q.textContent="Сохранить"}))})),U.addEventListener("submit",(function(n){n.preventDefault();var r,a=U.elements["place-name"],i=U.elements.link;R.textContent="Сохранение...",(r={name:a.value,link:i.value},fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:{authorization:e.headers.authorization,"Content-Type":"application/json"},body:JSON.stringify(r)}).then(t).catch((function(e){return console.error("Ошибка при загрузке информации о пользователе:",e)}))).then((function(e){var t=c(e,o,ee,te,X._id);I.prepend(t),U.reset(),u(A)})).catch((function(e){console.log(e)})).finally((function(){R.textContent="Сохранить"}))})),$.addEventListener("click",(function(){u(V)})),H.addEventListener("click",(function(){_(j,{inputErrorClass:Z.inputErrorClass,errorClass:Z.errorClass,inactiveButtonClass:Z.inactiveButtonClass}),a(F)})),G.addEventListener("click",(function(){u(F)})),W.addEventListener("click",(function(){var n,r;Y.currentCardId&&(n=Y.currentCardId,(r=document.querySelector('.places__item[data-card-id="'.concat(n,'"]')))?function(n){return fetch("".concat(e.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:{authorization:e.headers.authorization}}).then(t).catch((function(e){return console.error("Ошибка при загрузке информации о пользователе:",e)}))}(n).then((function(){r.remove()})).catch((function(e){console.log(e)})):console.error("Card element not found"),u(V))})),K.addEventListener("click",(function(n){n.preventDefault();var r,o=F.querySelector(".popup__input_type_url");K.textContent="Сохранение...",(r={avatar:o.value},fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:{authorization:e.headers.authorization,"Content-Type":"application/json"},body:JSON.stringify(r)}).then(t).catch((function(e){return console.error("Ошибка при загрузке информации о пользователе:",e)}))).then((function(e){var t=e.avatar,n="".concat(t,"?").concat((new Date).getTime());H.style.backgroundImage="url(".concat(n,")"),K.textContent="Сохранить",j.reset(),u(F)})).catch((function(e){console.log(e)})).finally((function(){K.textContent="Сохранить"}))})),v=(h=Z).formSelector,y=h.inputSelector,C=h.submitButtonSelector,S=h.inactiveButtonClass,b=h.inputErrorClass,E=h.errorClass,Array.from(document.querySelectorAll(v)).forEach((function(e){!function(e,t){var n=t.inputSelector,r=t.submitButtonSelector,o=t.inactiveButtonClass,c=t.inputErrorClass,a=t.errorClass,u=Array.from(e.querySelectorAll(n)),i=e.querySelector(r);p(u,i,o),u.forEach((function(t){t.addEventListener("input",(function(){!function(e,t,n,r){""!==t.value?f([t])?s(e,t,t.dataset.errorMessage,n,r):d(e,t,n,r):s(e,t,t.validationMessage,n)}(e,t,c,a),p(u,i,o)}))}))}(e,{inputSelector:y,submitButtonSelector:C,inactiveButtonClass:S,inputErrorClass:b,errorClass:E})})),Promise.all([fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then(t).catch((function(e){return console.error("Ошибка при загрузке информации о пользователе:",e)})),fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then(t).catch((function(e){return console.error("Ошибка при загрузке информации о пользователе:",e)}))]).then((function(e){var t,n,r=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c,a,u=[],i=!0,l=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(r=c.call(n)).done)&&(u.push(r.value),u.length!==t);i=!0);}catch(e){l=!0,o=e}finally{try{if(!i&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return u}}(t,n)||function(e,t){if(e){if("string"==typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=r[0],u=r[1];X=a,N.textContent=a.name,J.textContent=a.about,H.style.backgroundImage="url(".concat(a.avatar,")"),u.forEach((function(e){var t;t=c(e,o,ee,te,X._id),I.append(t)}))})).catch((function(e){console.log(e)}))})();